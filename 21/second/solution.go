package main

import (
	"fmt"
	"strconv"
	"strings"
	"time"
)

func main() {

	startTime := time.Now()

	var rows = strings.Split(input, "\n")
	var mapp [][]rune

	var startCoord Coord
	for i, row := range rows {
		var newRow []rune
		for k, cell := range row {
			newRow = append(newRow, cell)
			if cell == 'S' {
				startCoord = Coord{i, k}
			}
		}
		mapp = append(mapp, newRow)
	}

	countInternal2 := 0
	countInternal := 0

	var prevSteps = make(map[string]Coord)
	var currSteps = make(map[string]Coord)
	var nextSteps = make(map[string]Coord)

	currSteps[toStr(startCoord)] = startCoord
	p0 := 0
	p1 := 0
	p2 := 0

	for i := 1; i < steps+0; i++ {

		for _, value := range currSteps {
			coordN := Coord{value.x - 1, value.y}
			if isValid(coordN, mapp) {
				_, isOk := prevSteps[toStr(coordN)]
				if !isOk {
					nextSteps[toStr(coordN)] = coordN
				}
			}

			coordS := Coord{value.x + 1, value.y}
			if isValid(coordS, mapp) {
				_, isOk := prevSteps[toStr(coordS)]
				if !isOk {
					nextSteps[toStr(coordS)] = coordS
				}
			}

			coordE := Coord{value.x, value.y + 1}
			if isValid(coordE, mapp) {
				_, isOk := prevSteps[toStr(coordE)]
				if !isOk {
					nextSteps[toStr(coordE)] = coordE
				}
			}

			coordW := Coord{value.x, value.y - 1}
			if isValid(coordW, mapp) {
				_, isOk := prevSteps[toStr(coordW)]
				if !isOk {
					nextSteps[toStr(coordW)] = coordW
				}
			}
		}

		placeholder := countInternal2
		countInternal2 = countInternal
		countInternal = placeholder + len(currSteps)
		prevSteps = currSteps
		currSteps = nextSteps
		nextSteps = make(map[string]Coord)

		if i == 65 {
			p0 = countInternal2 + len(currSteps)
		} else if i == 131+65 {
			p1 = countInternal2 + len(currSteps)
		} else if i == (131*2)+65 {
			p2 = countInternal2 + len(currSteps)
			break
		}
	}

	c := p0
	a := (p2 + c - 2*p1) / 2
	b := p1 - c - a

	var x int = steps / 131

	res := a*x*x + b*x + c

	elapsedTime := time.Since(startTime)
	fmt.Printf("Your function took %s\n", elapsedTime)
	fmt.Println(res)
}

func isValid(c Coord, mapp [][]rune) bool {
	x := c.x % len(mapp)
	if x < 0 {
		x += len(mapp)
	}

	y := c.y % len(mapp[0])
	if y < 0 {
		y += len(mapp[0])
	}

	if mapp[x][y] == '#' {
		return false
	}
	return true
}

func toStr(coord Coord) string {
	return strconv.Itoa(coord.x) + "," + strconv.Itoa(coord.y)
}

type Coord struct {
	x int
	y int
}

const steps = 26501365
const input = `...................................................................................................................................
..#..#.........................................##..........##.........#....#...#...#.#.....#..........#......#.......#....#........
............#...............#.................#.........#.#.........................#.......#................#.....................
.....##.....#..###.......####....#.......#..............................#.............#..........#.....#.#....#...#......#......#..
...#............#.....#...........#.........#.#.........#.....................................##............#...#....#..#....#.....
....#.......#.................#.....#.........##....................................##....#.....#........##...#............####....
..........#.#........#....#..........#.......#.....#............#................#..........#...#..........#....#.......#...#....#.
.........#.......#.......#....#...####.#.....................................#..##.....#................#.#.....#...........#......
....#.............#........#..#...#...............#.#..........#....#........#.............#.#.#.........#...#........#.........#..
...#....##........................#.............#..................##.............#.................#..#.......................#...
...........#......#....#...........#........................#.....................#.....#.....................#.............##.#...
...................#...........#..#...........#...#............#......#..........#.........###.#.##............#......#...#....#...
.#......#...#..#...#...#.#..................#..................#....................................#.#...#..#.....................
....#....#..............#.....#.......#........#....................................................##...#..................##.....
.........#.......................###....................#...#.........#................#.....##.............#......#.........#.....
......##....##...............#.........................#.#.#........#......##........#.................##.......#..#......#...#....
........#..........#..#.#....####.#..#.......................#..............#........#........#....#..............#....#......#....
..............#...#.....#....##..........................##............#......#..........#.....##..#.#......##..........#.....#....
...#......#....##.....#......#.......#.......................#..#.............................#.......#...#....................#...
.........................#..#..#..................#.............................#..............................##.......#...#.#....
................#....#..#...........###.....................#.........#......##...........#...............#....##.#...###.##.......
...#.#.........#.......................##.............#..#...........##....#....#..............#......#...................#........
...#.......#.##............#.##..#..................#.....#..#..........#............................#.........#......#............
....................#..............................#........#..#..#.....#....#.#...............#......#...#.....................#..
..#..##........#..#..#.....###......#..........................#...........##.......#................#............#...#........#...
..........#.##.#.......#.....#...#..........#............#..#..#........#....#.#.................#.................#...#........#..
.......#........#.............#....#............#............#.........##.....................................#....#...............
...#.#................#.#.#............................#.#..............#.#.....#.#.....#........##...............##....#........#.
....#...#.#.#..#...........................#...........#..............#........#.#..#.......................#.##.......#.......#...
.#....#..#...#...#...#.......#.............#........#......#.........#.#....#......#..............#................................
.....................#..##.....#...........#..........#...................#..#......#..............................#.......#.......
......#.#.#.##.......#.#.......................#...............#...#...........#......#..............#....#.............#..........
.#...................#....#..#........###...........#.............#.........#........#.##...#..........##..........................
..##....#....#..#.......#...............##.....#...#....###.#.............#.....#.............#..................##....#.#..##.#...
......#....##......#...#...#..........#................................................................#...#.......#............#..
..#...........#.....................##...........#...#....#...........#.........#....................................#..#........#.
...#...#.........................##.....##.#######.........#..#...#..#.......#..#.......#...#...............#.#.........##.........
......#.#....#.......#..................##....##......#.........#...#........#.....#.........##.................#.......#.......#..
..................................#......#..##........#......#....##....................#..................#.#...........#...#.....
..#.#......#...#.....#.........#...#...#.......#.#....................#......#...##.........#....#...............#..........#......
...........#....................#...........#......#....#.#...............#.#..#...##.........###.##............#.....#.#..........
.###.#.......................#.....#......#...#....#......##.#.#..#.#...........###...............#.................#..#..#........
..#...#....#.................#.#...#.................#.......#......#.#..#...#........##..##...#.....................#...#.....#...
..#.#....##.................#.#...#....#...........#..#.#...#..........##..................................................#...##..
..#......#.................#........#...#.........#.........#.#.....#...#.##.......#...............................#...............
........#.....#...............#....#........#.......##.....#...................#......#..............#..#.#.......#................
...........................#...##.......#............#.........#..#......#.........##..#.#..........####...#..........#............
...#...#.....#..............#......##.##........#......................#......#.#...#................#......#.........##...........
....#.....#..................#...............#.#...........#..#........#................#..#..#........#...........................
.....#.......................#......................#..........#..........#....#.#....#.........#......#....##..................#..
.####.........................#.#.......#.#..#..#.......#...#..#...##.##.......................#.###...........#..........#........
..........#..........#.#......................................#........#................#....#.##..##.....#..##....................
...................#.#....#...........................#...#..........#.......#..............#...........#.................#........
.......#........#.......#.....#...........#.........#........#.....##.......#.......#.................#...##..##...........#....##.
.....#....................#..............................##.....#......#.........................#...#...#......#..........#..#....
.#...#........#....#.....#.............#..#......##.....#.........................#..#....##......#....##..#.......................
.............#.....#......#....#.....................#.........#.........##....#........#..........#.......#...#...................
.............................###..................##......#..#...............#..#.............#...............#.....#............#.
.##.............#......#.........#...#....#...#.....#...###..#..#.#..#........#.#...#...#..#.#.....##.......##.....................
..#.........#.......#.......#............#..............#............#..##...##.......#............###.#....#.......#..............
..............#......#....#...#.....#......................#......#....#..........................#............#.....#..#........#.
.........#.....#.....................#...#...............###...........#...........##.#..#.#...#...#........#...#.....#............
..........#..#...#...#.#.........#............#..#..............#..#.......#.....#.#.........#..#..........#........#..............
.........#.#..........#.#.......#..#.....#......#.......##..#...#.#...#...#.....##.............#..#..........#.##...........#......
.........#............#.#........#........#.#..#..#..#.....................#.........#.#..........#......#....#......#....#........
.................................................................S.................................................................
......#......#............#....#....#....#.........##..#.............#......#....#......#.#......#...#.#.......#..##..#..#...#.....
.......#...........#......#......#................##....#..#..#...............#..##.........##...............#.........#...........
.......#........##...............#...........#..#...#..#.##............#..#..#.............#..............#........#....#..#.......
........#...#.......#.........##...................#...#..........#.....#.#.................#..##...........#.#........#.##........
............#.....#...........#.......##.#...#...........................................#.....#........#...#......................
.##..............#....#..#....#.#.#..#........#....................#.........#............#..........#......#.#....................
..........................#..........#..............##..#......#....###.#..................#.....#...........#.....................
....#.......###.............................#...............##.#....#.............#.#.....#....#...#.#.......#.....##.#............
..............#.#.......#........#.....#............##..........#...........##.......................#.......#...................#.
......#.........#..........##.....#...........................#.............................................#.....##........#......
....................#......#.............#.#.#..#.##..##..#....#....#...........#....#.#..................#......#..............##.
....#.................#...#......#...##...................#...............#.............................##......#..........#.......
........................#..#.#.........#.............#.......#..#...............#.....##...............###.....##............#.....
...#..#................#.#.....#...................#......##.............#.....................#...#.....#...................#.....
.#.......#............................#.......#......................#.......#.......#...#.#.......................................
....#.................#..#.....#.#.#...#.....#............#..............................##.....#.....#....#.............#.........
......#..#..........................#..#.##.........#.....#....#...............#.#...............#.#..................#............
.......#....#.........#.....#..#...#..............#..........#......................#.............#...................##..#..#.....
......#.#....##..........#..#......#........................#..............#..#...........#..#....#........#.........#....#.#......
....#..#...#.##.............#..#......#.....................#.......#....#.##..#..#..#...#.#.....#..#................###.....##..#.
...............#.............................##..##............#...#...#..#..#.....#.................##............#..#.......#....
.#......#.####....#............#......#.....#..........#...##.............#.......#..##.........#......................#.#.#....#..
.....#...#..........................#...........#..................##.##.#....#.#............#......#...........................#..
..................#............#....#.....#.................#.#.......#.................##.........#.##.......#....#.........#.....
.............###.#..#........#..#.........#.........................#.....#...#........#...#...#......................#..#.#....#..
.....#.###......#...#...............##..##.................#........#.........##...#....................................#..........
...#.#...#............#......................#...........#..............##....#......#....#.....................................#..
......#.....##...##...#.#..............#.....................#.#...#..............#......#.###...................#.................
..#.#................................#...........#............#.#.#........................#..#.#............#......#..........#...
...................#.#.................#..#......#..........#..#............#..............................###..#..........##......
...........#.........#................##...#..#...#.#..........#..#.........#..##.........................#...............#........
..............#.............#.......#........#..#.#..#.##.#.#...............##..........#..............#.................#.#.......
....#..##..#....#............................#....#...#...#.........#...#.#...............#..........#..........#.........##....#..
........#...#......##.........................#.###.#.............#...#............#....................#.....#...#..#......#...#..
..#...............##...................#......#....##...........#...#.........##......................#..........................#.
.......#........#.........#.............#.......#.........................#.....#.#...#..#....................#..#.....#......#....
.........#...#.......#........#.............#...........#.#..#..#...#......#..........#..#..............#...#.....#..........#.....
..#.........#......##.............................#.....##..#..................##.....##.............##...........#.###............
..#.###..#...........#...#...............................#........##..##......#...................#...#...................#........
.............#............#..#.....................#..#.#.....#....#.#..#............#...............#.#.....#......#..........##..
..................#.................#..........#.#.....#...........#.......#........##.......#..............#....#...#.............
.................#.##....##.#..#....#.#........#......#....................#.....#.#........#.................#..#.....#...........
..#..........#..........#.............#...........#...................#.........................#.#.........#........#......#......
...............#........#.........#...................#................#....................#..##.....#...#.#..#..........#....#...
.........#...........#.................#.#.................#....#.............#...........#.......#.............#..................
...............#................##..##..#...........#.....#...##........#..........................##.#...#.#...............#......
...................##.................##...........#........#...............................#..#........#..#...#....#............#.
.....##.............#.#.........#...........#...........#.#.....#.........##.........................#.............................
.##....#.............#.#.............................###..#..........#..................#................#..#......................
......................##........#......#...................#...#...#.......#...............#..............##.##...#..........#.#...
......#...#.......#.......................#.....................#.###..#..............#........#..#..##...#....#...................
....##.....#....................#.......##.#....#..........#......#...............#...##..............#.......#....#....#..........
.#...#...#.#..#.#.#.#..........#........#.......#...........#........#...........#....................##.............#........#....
................#...#.#.##.......#..#.....##..#...#................#................#..#........................................#..
.....#.#......#...........#..#.....#.#.#.#......#...........#.....#..................#..#.##...#........................##.....#.#.
............#...#.......#.#...#.........#......................#...#..................#..................##.........#.#..........#.
..#....#....##..................#...................................#...........##.###..#...#....#...............#............#.#..
.................##.........#.......#................#.......................#....#....#.....................#..#..................
..................#.........#.#..............................................................#....#............#...................
.............................#.#.#.#..............#.#...........#..........#........#.............#................#.......#....#..
.......................#..#.......#...#....................................##.#.##....#..........#......#....#............##.......
.............#.....#.#..#.#..##..##.........#.#.#..#.........................................#.....#.............#.##..............
..#.#.#.......#...................#.............###.............................................#..................................
.........#...###................#......#.......##.......###.............##....#.#.............#.........#.................#..#.#...
...................................................................................................................................`

const result = 620348631910321
